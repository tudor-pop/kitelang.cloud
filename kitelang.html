<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kite – Code Demo Tabs</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg:#0d141a;
            --panel:#121a22;
            --panel-2:#0f171e;
            --muted:#9aa5b1;
            --text:#e7ecf2;
            --accent:#6d5dfc;
            --accent-2:#9a4ef5;
            --border:rgba(255,255,255,.08);
            --shadow:0 10px 30px rgba(0,0,0,.35);
            --radius:16px;
            --mono:'Fira Code', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            --purple:#a855f7;  /* keywords */
            --blue:#00aaff;    /* types */
            --green:#7ee787;   /* strings */
            --yellow:#facc15;  /* decorator */
            --grey:#9aa5b1;    /* comments (lighter grey) */
            --red:#ff6b6b;     /* destroy */
            --orange:#ffa500;  /* change */
        }

        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }

        body {
            display: flex; justify-content: center; align-items: center;
            background: var(--bg); color: var(--text);
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
            padding: 4px;
        }

        .code-demo { display:flex; flex-direction:column; width:100%; height:100%; background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden }

        .demo-header{display:flex; gap:22px; align-items:flex-end; padding:10px 8px 0; background:var(--panel-2); border-bottom:1px solid var(--border)}
        .tabs{display:flex; gap:18px}
        .tab{position:relative; padding:14px 6px; font-weight:600; letter-spacing:.2px; color:var(--muted); cursor:pointer; user-select:none}
        .tab.active{color:var(--text)}
        .tab.active:after{content:""; position:absolute; left:0; right:0; bottom:-1px; height:3px; background:linear-gradient(90deg,var(--accent),var(--accent-2)); border-radius:3px 3px 0 0}

        .editor{flex:1; background:#0d1117; overflow:hidden}
        pre{margin:0; padding:8px; height:100%; overflow:auto; font-family:var(--mono); font-size:15px; line-height:1.6}

        .tok-kw{color:var(--purple)}
        .tok-type{color:var(--blue)}
        .tok-str{color:var(--green)}
        .tok-deco{color:var(--yellow)}
        .tok-com{color:var(--grey)!important;}
        .tok-com-bold{color:var(--grey)!important; font-weight:600}
        .tok-red{color:var(--red)}
        .tok-orange{color:var(--orange)}
        .tok-green{color:var(--green)}
        .tok-purple{color:var(--purple)}

        .demo-footer{display:flex; justify-content:space-between; align-items:center; padding:10px 8px; border-top:1px solid var(--border); background:#0d1117; color:var(--muted); font-size:13px}

        @media (max-width:720px){ .tabs{gap:10px} .tab{font-size:14px} pre{font-size:14px} }
    </style>
</head>
<body>
<div class="code-demo" role="region" aria-label="Kite code demo">
    <div class="demo-header">
        <div class="tabs" role="tablist">
            <div class="tab active" data-id="resources">Resources</div>
            <div class="tab" data-id="components">Components</div>
            <div class="tab" data-id="mixins">Mixins</div>
            <div class="tab" data-id="import">Existing resources</div>
            <div class="tab" data-id="tests">Easy refactors</div>
        </div>
    </div>

    <div class="editor"><pre id="code"></pre></div>

    <div class="demo-footer">
        <span id="brand-text">Kite • Write once, deploy anywhere</span>
        <span id="status">Ready</span>
    </div>
</div>

<script>
    const snippets = {
        resources: `import Bucket from "kite.cloud.storage.Bucket" // clean import statement

@provisionOn([aws, gcp])
resource Bucket photos {
    name = "my-photos"
}

// decorator and metadata are outside the resource block. Provisioning to some default provider
@dependsOn(Bucket.photos)
resource Bucket videos {
    name = "my-videos"
}

for bucket in [Bucket.photos, Bucket.videos] {
    println(bucket)
}
`,
        components: `import Bucket from "kite.cloud.storage.Bucket"

component Frontend {
    @allow(['client1', 'client2'])
    input string name = 'client1'

    resource Bucket logs { ... }
    resource Bucket metrics { ... }

    output string arn = Bucket.logs.arn
}

// create both buckets by using a component
component Frontend prod {
    name = "client2"
}
`,
        mixins: `import Bucket from "kite.cloud.storage.Bucket"

resource Bucket photos {
  name = "my-photos"
}
// Resource properties tailored to each cloud provider
mixin gcp on photos { uniform_bucket_level_access = true }
mixin aws on photos { account_id = "421123456670" }

// type specific properties on all instances
mixin gcp on Bucket { uniform_bucket_level_access = true }
mixin aws on Bucket { account_id = "421123456670" }

// properties on all gcp resources
mixin gcp on * { tags = { env: 'prod' } }
// properties on all aws resources
mixin aws on * { tags = { env: 'prod' } }

// general properties for all buckets
mixin Bucket { tags = { env: 'prod' } }
`,
        import: `import Bucket from "aws.s3.Bucket"

// adopt an existing bucket (no recreate)
@existing("arn:aws:s3:::company-assets")
resource Bucket assets {
  name = "company-assets"
}

// attach provider-specific metadata to the adopted resource
mixin aws on assets { account_id = "421123456670" }
`,
        tests: `// file.kite
resource Bucket example {
    bucket = "logs"
}
// rename bucket 'example' to 'kite'. A simple resource name change is enough
resource Bucket kite {
    bucket = "logs"
}

// console output
# DummyResource.example will be renamed to DummyResource.kite
resource DummyResource example -> kite {
    bucket = "kite-bucket"
}
Plan: 0 to add, 0 to change, 0 to destroy, 1 to rename.`
    };

    const footerMessages = {
        resources: 'Define and iterate over a list of resources',
        components: 'Compose infrastructure into reusable components',
        mixins: 'Compose cross-cutting behavior with mixins',
        import: 'Existing resources',
        tests: 'Easy refactors'
    };

    function escapeHtml(s){
        return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    function highlightKite(src, isRefactor = false) {
        const STR_L = '\uE000', STR_R = '\uE001';
        const COM_L = '\uE002', COM_R = '\uE003';
        const strings = [], comments = [];

        let out = escapeHtml(src);

        // 1) Extract comments FIRST (matches // and # anywhere, not just at line start)
        out = out.replace(/\/\/.*?(?=$|\n)|#.*?(?=$|\n)/g, m => {
            const i = comments.push(m) - 1;
            return COM_L + i + COM_R;
        });

        // 2) Extract strings (double OR single quotes) - but only outside comments
        out = out.replace(/\"([^\"\\]|\\.)*\"|'([^'\\]|\\.)*'/g, m => {
            const i = strings.push(m) - 1;
            return STR_L + i + STR_R;
        });

        // Special handling for refactor tab plan line
        if (isRefactor) {
            out = out.replace(/Plan: (\d+) to add, (\d+) to change, (\d+) to destroy, (\d+) to rename\./g, (match, add, change, destroy, rename) => {
                return `Plan: <span class="tok-green">${add}</span> to add, <span class="tok-orange">${change}</span> to change, <span class="tok-red">${destroy}</span> to destroy, <span class="tok-purple">${rename}</span> to rename.`;
            });
        }

        // 3) Decorator (any @identifier)
        out = out.replace(/@[A-Za-z_][A-Za-z0-9_]*/g, m => `<span class="tok-deco">${m}</span>`);

        // 4) Keywords (core)
        out = out.replace(/\b(import|from|resource|for|in|component|input|output)\b/g,
            m => `<span class="tok-kw">${m}</span>`
        );
        // 4b) Keywords for mixins
        out = out.replace(/\b(mixin|on)\b/g, m => `<span class="tok-kw">${m}</span>`);

        // 5) Types
        out = out.replace(/\bBucket\b/g, '<span class="tok-type">Bucket</span>');
        out = out.replace(/\bstring\b/g, '<span class="tok-type">string</span>');
        out = out.replace(/\bDummyResource\b/g, '<span class="tok-type">DummyResource</span>');

        // 5b) Arrow operator - use placeholder to avoid escaping issues
        const ARROW_L = '\uE004', ARROW_R = '\uE005';
        const arrows = [];
        out = out.replace(/->/g, m => {
            const i = arrows.push(m) - 1;
            return ARROW_L + i + ARROW_R;
        });

        // 6) Reinsert strings
        out = out.replace(new RegExp(STR_L + '(\\d+)' + STR_R, 'g'),
            (_, i) => `<span class="tok-str">${strings[+i]}</span>`
        );

        // 7) Reinsert comments last so no highlighting happens inside them
        out = out.replace(new RegExp(COM_L + '(\\d+)' + COM_R, 'g'),
            (_, i) => {
                let commentText = comments[+i];
                // Make "// console output" bold
                if (commentText.includes('console output')) {
                    return `<span class='tok-com-bold'>${commentText}</span>`;
                }
                // Allow arrow operator to be highlighted inside comments
                commentText = commentText.replace(/->/g, '<span class="tok-purple">-></span>');
                return `<span class='tok-com'>${commentText}</span>`;
            }
        );

        // 8) Reinsert arrows
        out = out.replace(new RegExp(ARROW_L + '(\\d+)' + ARROW_R, 'g'),
            (_, i) => `<span class="tok-purple">${arrows[+i]}</span>`
        );

        return out;
    }

    const codeEl = document.getElementById('code');
    const tabs = document.querySelectorAll('.tab');
    const status = document.getElementById('status');
    const brandText = document.getElementById('brand-text');

    function setTab(id){
        tabs.forEach(t => t.classList.toggle('active', t.dataset.id === id));
        const isRefactor = id === 'tests';
        codeEl.innerHTML = highlightKite(snippets[id] || '', isRefactor);
        brandText.textContent = footerMessages[id] || 'Kite • Write once, deploy anywhere';
        status.textContent = `Showing: ${id}`;
    }

    tabs.forEach(t => t.addEventListener('click', () => setTab(t.dataset.id)));

    setTab('resources');
</script>
</body>
</html>